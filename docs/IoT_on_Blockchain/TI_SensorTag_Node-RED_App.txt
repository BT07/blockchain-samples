[{"id":"b6b49366.ce6428","type":"mqtt out","z":"594de9f7.6f2a38","name":"Publish to IoT","topic":"iot-2/evt/CreateIoTDevice/fmt/json","qos":"0","retain":"false","broker":"65babaa4.85bb74","x":640,"y":140,"wires":[]},{"id":"b88e3d04.025dd8","type":"function","z":"594de9f7.6f2a38","name":"Asset payload","func":"var asset = \"iotsensor\";\nvar accelX = Number(msg.payload.d.accelX);\nvar accelY = Number(msg.payload.d.accelY);\nvar accelZ = Number (msg.payload.d.accelY);\nvar temperature = Number(msg.payload.d.objectTemp);\nvar key = Number(msg.payload.d.key1);\n\nvar counter1 = context.get('counter1')||0;\ncounter1 = counter1+1;\ncontext.set('counter1',counter1);\n\nif (key > 0){ \nmsg = {\n \tpayload: JSON.stringify({\n \"asset\": \"resource:org.poc.scbn.IoTDevice#iotsensor1234\",\n \"class\": \"org.poc.scbn.IoTDeviceReading\",\n \"deviceId\": \"iotsensor\",\n \"description\": \"iotsensor reading\",\n \"date\": \"2017-11-12T17:50:29.455Z\",\n \"time\": \"2017-11-12T17:50:29.455Z\",\n \"altitude\": 1000,\n \"accelX\": accelX,\n \"accelY\": accelY,\n \"accelZ\": accelZ,\n \"latitude\": 33.675,\n \"longitude\": 34.5,\n \"temperature\": temperature,\n \"humidity\": 80,\n \"eventCode\": 200,\n \"shipmentId\": 321456\n\t }\n )\n} }\n\nelse { \n msg = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":350.9998092651367,"y":300.999951839447,"wires":[["7702cc86.8613c4","8a3adb24.9a1e98"]]},{"id":"7702cc86.8613c4","type":"debug","z":"594de9f7.6f2a38","name":"","active":true,"console":"false","complete":"false","x":633.9998931884766,"y":446.99999219179153,"wires":[]},{"id":"3cbf6866.cba81","type":"comment","z":"594de9f7.6f2a38","name":"Configure Publish to IoT for your environment","info":"1. Double click the node.\n2. Click the edit icon next to the Server field.\n3. Update the Server name to correspond to your IoT Platform organization.\n `organization_ID.messaging.internetofthings.ibmcloud.com`\n\n4. Update the Client ID with your orgainzaiton ID, device type, and device ID:\n `d:organization_ID:device_type:device_ID`\n\n5. Click the Security tab.\n6. Verify that the Username field has the value use-auth-token.\n7. Update the Password field with the Authentication Token that you saved earlier.\n8 Click Update and then OK.\n9 In the upper right corner of the Node-RED flow editor, click Deploy. ","x":678.0000381469727,"y":104.00003051757812,"wires":[]},{"id":"352e3dd.5b4f5c2","type":"comment","z":"594de9f7.6f2a38","name":"Debug Node","info":"The Debug node causes any message to be displayed in the Debug sidebar. By default, it just displays the payload of the message, but it is possible to display the entire message object.","x":632.9999237060547,"y":411.9999949336052,"wires":[]},{"id":"76b55d15.f0ff94","type":"function","z":"594de9f7.6f2a38","name":"Asset payload","func":"var asset = \"iotsensor\";\nvar key = Number(msg.payload.d.key2);\nvar accelX = Number(msg.payload.d.accelX);\nvar accelY = Number(msg.payload.d.accelY);\nvar accelZ = Number (msg.payload.d.accelY);\nvar temperature = Number(msg.payload.d.objectTemp);\n\nvar counter1 = context.get('counter1')||0;\ncounter1 = counter1+1;\ncontext.set('counter1',counter1);\n\nif (key>0){\nmsg = {\n \tpayload: JSON.stringify({\n \"class\": \"org.poc.scbn.CreateIoTDevice\",\n \"deviceId\": \"iotsensor\",\n \"description\": \"Create iotsensor\",\n \"date\": \"2017-11-12T01:50:29.455Z\",\n \"time\": \"2017-11-12T01:50:29.455Z\",\n \"altitude\": 10000,\n \"accelX\": accelX,\n \"accelY\": accelY,\n \"accelZ\": accelZ,\n \"latitude\": 33.675,\n \"longitude\": 58.5,\n \"temperature\": temperature,\n \"humidity\": 80,\n \"eventCode\": 200,\n \"shipmentId\": \"326750\"\n }\n )\n}\n}\n\nelse { \n msg = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":348.1282730102539,"y":141.4548168182373,"wires":[["b6b49366.ce6428","7702cc86.8613c4"]]},{"id":"8a3adb24.9a1e98","type":"mqtt out","z":"594de9f7.6f2a38","name":"Publish to IoT","topic":"iot-2/evt/IoTDeviceReading/fmt/json","qos":"0","retain":"false","broker":"65babaa4.85bb74","x":636.1283416748047,"y":301.56594467163086,"wires":[]},{"id":"981c259e.7c4f18","type":"comment","z":"594de9f7.6f2a38","name":"Configure Publish to IoT for your environment","info":"1. Double click the node.\n2. Click the edit icon next to the Server field.\n3. Update the Server name to correspond to your IoT Platform organization.\n `organization_ID.messaging.internetofthings.ibmcloud.com`\n\n4. Update the Client ID with your orgainzaiton ID, device type, and device ID:\n `d:organization_ID:device_type:device_ID`\n\n5. Click the Security tab.\n6. Verify that the Username field has the value use-auth-token.\n7. Update the Password field with the Authentication Token that you saved earlier.\n8 Click Update and then OK.\n9 In the upper right corner of the Node-RED flow editor, click Deploy. ","x":683.1284103393555,"y":265.5659453868866,"wires":[]},{"id":"7a830e97.cbcfb8","type":"ibmiot in","z":"594de9f7.6f2a38","authentication":"quickstart","apiKey":"","inputType":"evt","deviceId":"b0b448b8f581","applicationId":"","deviceType":"+","eventType":"+","commandType":"","format":"json","name":"IBM IoT","service":"quickstart","allDevices":"","allApplications":"","allDeviceTypes":true,"allEvents":true,"allCommands":"","allFormats":"","qos":0,"x":130,"y":140,"wires":[["76b55d15.f0ff94"]]},{"id":"828ddb28.aa7b78","type":"ibmiot in","z":"594de9f7.6f2a38","authentication":"quickstart","apiKey":"","inputType":"evt","deviceId":"b0b448b8f581","applicationId":"","deviceType":"+","eventType":"+","commandType":"","format":"json","name":"IBM IoT","service":"quickstart","allDevices":"","allApplications":"","allDeviceTypes":true,"allEvents":true,"allCommands":"","allFormats":"","qos":0,"x":130,"y":300,"wires":[["b88e3d04.025dd8"]]},{"id":"65babaa4.85bb74","type":"mqtt-broker","z":"594de9f7.6f2a38","broker":"6gsn5g.messaging.internetofthings.ibmcloud.com","port":"8883","tls":"","clientid":"d:6gsn5g:iotsensor_device:iotsensor","usetls":true,"verifyservercert":true,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":""}]
